<!-- templates/history.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security6"
      th:with="activePage='history'"
      th:replace="~{layout/main :: layout(
          title        = 'Historial',
          page_content = ~{::#content},
          head_extra   = ~{},
          body_end     = ~{},
          activePage   = ${activePage}
      )}">

<body>
<div id="content" th:fragment="page_content" class="p-4">

  <div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">
      <i class="fas fa-history fa-sm"></i> Historial de sellados
    </h1>
    <a th:href="@{/upload}" class="btn btn-primary btn-sm shadow-sm">
      <i class="fas fa-file-upload fa-sm text-white-50"></i> Subir nuevo archivo
    </a>
  </div>

  <p class="mb-4">
    ¡Hola <strong sec:authentication="name">usuario</strong>!
    Aquí tienes los documentos que has sellado con BitSealer.
  </p>

  <div th:if="${hashSubido}" class="alert alert-success shadow-sm">
    Hash <code th:text="${hashSubido}"></code> almacenado correctamente.
  </div>
  <div th:if="${error}" class="alert alert-danger shadow-sm" th:text="${error}"></div>

  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">
        <i class="fas fa-list fa-sm"></i> Tus archivos sellados
      </h6>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th class="text-center" style="width:70px;">ID</th>
              <th>Archivo</th>
              <th>SHA-256</th>
              <th style="width:170px;">Fecha</th>
            </tr>
          </thead>
          <tbody>
            <!-- ↳ ahora usamos los campos del DTO -->
            <tr th:each="h : ${hashes}">
              <td class="text-center" th:text="${h.id}">1</td>
              <td th:text="${h.originalFilename}">ejemplo.pdf</td>
              <td class="font-monospace" th:text="${h.sha256}" style="word-break:break-all;">hash…</td>
              <td th:text="${#temporals.format(h.createdAt,'yyyy-MM-dd HH:mm')}">2025-06-15 18:25</td>
            </tr>

            <tr th:if="${hashes.empty}">
              <td colspan="4" class="text-center text-muted">
                Aún no has sellado ningún archivo.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
</body>
</html>
