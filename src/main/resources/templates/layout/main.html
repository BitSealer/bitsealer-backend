<!-- templates/layout/main.html -->
<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security6"
      th:fragment="layout (title, page_content, head_extra, body_end, activePage)">

<head>
  <meta charset="UTF-8"/>
  <title th:text="${title} ?: 'BitSealer'">BitSealer</title>

  <!-- CSS principal -->
  <link rel="stylesheet" th:href="@{/vendor/fontawesome-free/css/all.min.css}"/>
  <link rel="stylesheet" th:href="@{/css/sb-admin-2.min.css}"/>

  <th:block th:replace="${head_extra}"></th:block>
</head>

<body id="page-top">
<div id="wrapper">

  <!-- ╭─ Sidebar ─╮ -->
  <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

    <a class="sidebar-brand d-flex align-items-center justify-content-center" th:href="@{/}">
      <div class="sidebar-brand-icon rotate-n-15"><i class="fas fa-lock"></i></div>
      <div class="sidebar-brand-text mx-3">BitSealer</div>
    </a>

    <hr class="sidebar-divider my-0"/>

    <li class="nav-item" th:classappend="${activePage}=='home' ? ' active'">
      <a class="nav-link" th:href="@{/}">
        <i class="fas fa-home"></i><span>Inicio</span>
      </a>
    </li>

    <li class="nav-item" th:classappend="${activePage}=='upload' ? ' active'">
      <a class="nav-link" th:href="@{/upload}">
        <i class="fas fa-file-upload"></i><span>Subir Archivo</span>
      </a>
    </li>

    <li class="nav-item" th:classappend="${activePage}=='history' ? ' active'">
      <a class="nav-link" th:href="@{/history}">
        <i class="fas fa-history"></i><span>Historial</span>
      </a>
    </li>
  </ul>
  <!-- ╰─ Sidebar ─╯ -->

  <!-- ╭─ Contenido ─╮ -->
  <div id="content-wrapper" class="d-flex flex-column">
    <div id="content">

      <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
        <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
          <i class="fa fa-bars"></i>
        </button>

        <ul class="navbar-nav ml-auto">

          <!-- ░░░ Enlace SÓLO para usuarios anónimos ░░░ -->
          <li sec:authorize="isAnonymous()" class="nav-item">
            <a class="nav-link" th:href="@{/login}">
              <i class="fas fa-sign-in-alt mr-1"></i> Iniciar&nbsp;sesión
            </a>
          </li>

          <!-- ░░░ Dropdown SÓLO para usuarios autenticados ░░░ -->
          <li sec:authorize="isAuthenticated()" class="nav-item dropdown no-arrow">
            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
               data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="mr-2 d-none d-lg-inline text-gray-600 small"
                    sec:authentication="name">User</span>
              <i class="fas fa-user-circle fa-lg"></i>
            </a>

            <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                 aria-labelledby="userDropdown">

              <!-- Ver perfil (placeholder) -->
              <a class="dropdown-item disabled" href="#">
                <i class="fas fa-id-badge fa-sm fa-fw mr-2 text-gray-400"></i>
                Ver perfil (próximamente)
              </a>

              <div class="dropdown-divider"></div>

              <!-- Cerrar sesión -->
              <a class="dropdown-item" href="#"
                 onclick="document.getElementById('logoutForm').submit();">
                <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                Cerrar sesión
              </a>

              <!-- Formulario POST oculto -->
              <form id="logoutForm" th:action="@{/logout}" method="post" th:csrf="true"
                    style="display:none;"></form>
            </div>
          </li>

        </ul>
      </nav>

      <div class="container-fluid px-4 pt-4" th:replace="${page_content}"></div>

    </div>
  </div>
  <!-- ╰─ Contenido ─╯ -->
</div>

<script th:src="@{/vendor/jquery/jquery.min.js}"></script>
<script th:src="@{/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/vendor/jquery-easing/jquery.easing.min.js}"></script>
<script th:src="@{/js/sb-admin-2.min.js}"></script>

<th:block th:replace="${body_end}"></th:block>
</body>
</html>
